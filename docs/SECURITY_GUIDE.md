# ุฏููู ุงูุฃูุงู ูุงูุญูุงูุฉ - ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุดููุงุช

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุฃูุงู](#ูุธุฑุฉ-ุนุงูุฉ-ุนูู-ุงูุฃูุงู)
2. [ูุนุงููุฑ ุงูุงูุชุซุงู](#ูุนุงููุฑ-ุงูุงูุชุซุงู)
3. [ุฃูุงู ุงูุจูุงูุงุช](#ุฃูุงู-ุงูุจูุงูุงุช)
4. [ุงููุตุงุฏูุฉ ูุงูุชูููุถ](#ุงููุตุงุฏูุฉ-ูุงูุชูููุถ)
5. [ุฃูุงู ุงูุดุจูุฉ](#ุฃูุงู-ุงูุดุจูุฉ)
6. [ุฃูุงู ุงูุชุทุจูู](#ุฃูุงู-ุงูุชุทุจูู)
7. [ูุฑุงูุจุฉ ุงูุฃูุงู](#ูุฑุงูุจุฉ-ุงูุฃูุงู)
8. [ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูุงูุงุณุชุนุงุฏุฉ](#ุงููุณุฎ-ุงูุงุญุชูุงุทูุฉ-ูุงูุงุณุชุนุงุฏุฉ)
9. [ุฅุฏุงุฑุฉ ุงูุญูุงุฏุซ ุงูุฃูููุฉ](#ุฅุฏุงุฑุฉ-ุงูุญูุงุฏุซ-ุงูุฃูููุฉ)
10. [ุงูุชุฏุฑูุจ ูุงูุชูุนูุฉ](#ุงูุชุฏุฑูุจ-ูุงูุชูุนูุฉ)

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุฃูุงู

### ูุจุงุฏุฆ ุงูุฃูุงู ุงูุฃุณุงุณูุฉ

#### ุงูุณุฑูุฉ (Confidentiality)
- ุชุดููุฑ ุฌููุน ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- ุงูุชุญูู ูู ุงููุตูู ุญุณุจ ุงูุญุงุฌุฉ
- ุญูุงูุฉ ุงูุจูุงูุงุช ุฃุซูุงุก ุงูููู ูุงูุชุฎุฒูู

#### ุงูุชูุงูู (Integrity)
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ููุน ุงูุชูุงุนุจ ุบูุฑ ุงููุตุฑุญ ุจู
- ุชุณุฌูู ุฌููุน ุงูุชุบููุฑุงุช

#### ุงูุชููุฑ (Availability)
- ุถูุงู ุงุณุชูุฑุงุฑูุฉ ุงูุฎุฏูุฉ
- ุฎุทุท ุงูุงุณุชุนุงุฏุฉ ูู ุงูููุงุฑุซ
- ูุฑุงูุจุฉ ุงูุฃุฏุงุก ุงููุณุชูุฑุฉ

### ุฅุทุงุฑ ุงูุฃูุงู ุงููุชุนุฏุฏ ุงูุทุจูุงุช

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           ุทุจูุฉ ุงููุณุชุฎุฏู            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ           ุทุจูุฉ ุงูุชุทุจูู             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ           ุทุจูุฉ ุงูุดุจูุฉ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ         ุทุจูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ        ุทุจูุฉ ูุธุงู ุงูุชุดุบูู           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ          ุทุจูุฉ ุงูุฃุฌูุฒุฉ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ูุนุงููุฑ ุงูุงูุชุซุงู

### HIPAA (Health Insurance Portability and Accountability Act)

#### ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ
- **ุงูุญูุงูุฉ ุงูุฅุฏุงุฑูุฉ**: ุณูุงุณุงุช ูุฅุฌุฑุงุกุงุช ุงูุฃูุงู
- **ุงูุญูุงูุฉ ุงูููุฒูุงุฆูุฉ**: ุฃูุงู ุงููุฑุงูู ูุงูุฃุฌูุฒุฉ
- **ุงูุญูุงูุฉ ุงูุชูููุฉ**: ุฃูุงู ุฃูุธูุฉ ุงููุนูููุงุช

#### ุชุทุจูู HIPAA ูู ุงููุธุงู
```javascript
// ูุซุงู ุนูู ุชุณุฌูู ุงููุตูู ููุจูุงูุงุช ุงูุทุจูุฉ
const auditLog = {
  userId: 'doctor123',
  action: 'VIEW_PATIENT_RECORD',
  patientId: 'patient456',
  timestamp: new Date().toISOString(),
  ipAddress: '192.168.1.100',
  userAgent: 'Mozilla/5.0...',
  dataAccessed: ['demographics', 'medical_history'],
  justification: 'Patient consultation'
};

await logAuditEvent(auditLog);
```

### ISO 27001

#### ูุธุงู ุฅุฏุงุฑุฉ ุฃูุงู ุงููุนูููุงุช (ISMS)
- ุชูููู ุงููุฎุงุทุฑ ุงูููุชุธู
- ุณูุงุณุงุช ุงูุฃูุงู ุงูููุซูุฉ
- ุงูุชุญุณูู ุงููุณุชูุฑ

#### ุถูุงุจุท ุงูุฃูุงู
```yaml
# ูุซุงู ุนูู ุถูุงุจุท ุงููุตูู
access_controls:
  authentication:
    - multi_factor_authentication: required
    - password_policy: strong
    - session_timeout: 30_minutes
  
  authorization:
    - role_based_access: enabled
    - principle_of_least_privilege: enforced
    - regular_access_review: quarterly
```

### GDPR (General Data Protection Regulation)

#### ุญููู ุงููุฑุถู
- **ุงูุญู ูู ุงููุตูู**: ุนุฑุถ ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ
- **ุงูุญู ูู ุงูุชุตุญูุญ**: ุชุนุฏูู ุงูุจูุงูุงุช ุบูุฑ ุงูุตุญูุญุฉ
- **ุงูุญู ูู ุงููุญู**: ุญุฐู ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ
- **ุงูุญู ูู ุงูููู**: ุชุตุฏูุฑ ุงูุจูุงูุงุช

#### ุชุทุจูู GDPR
```javascript
// API ูุชุตุฏูุฑ ุจูุงูุงุช ุงููุฑูุถ
app.get('/api/patients/:id/export', async (req, res) => {
  const patientId = req.params.id;
  
  // ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
  if (!canAccessPatientData(req.user, patientId)) {
    return res.status(403).json({ error: 'ุบูุฑ ูุตุฑุญ' });
  }
  
  // ุชุณุฌูู ุทูุจ ุงูุชุตุฏูุฑ
  await logDataExport(req.user.id, patientId);
  
  // ุชุตุฏูุฑ ุงูุจูุงูุงุช
  const patientData = await exportPatientData(patientId);
  
  res.json({
    exportDate: new Date().toISOString(),
    dataSubject: patientId,
    data: patientData
  });
});
```

## ุฃูุงู ุงูุจูุงูุงุช

### ุชุดููุฑ ุงูุจูุงูุงุช

#### ุงูุชุดููุฑ ุฃุซูุงุก ุงูุชุฎุฒูู
```javascript
const crypto = require('crypto');

// ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
const encryptSensitiveData = (data, key) => {
  const algorithm = 'aes-256-gcm';
  const iv = crypto.randomBytes(16);
  const cipher = crypto.createCipher(algorithm, key, iv);
  
  let encrypted = cipher.update(data, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  const authTag = cipher.getAuthTag();
  
  return {
    encrypted,
    iv: iv.toString('hex'),
    authTag: authTag.toString('hex')
  };
};

// ูุซุงู ุนูู ุชุดููุฑ ุฑูู ุงููููุฉ
const encryptedNationalId = encryptSensitiveData(
  patient.nationalId, 
  process.env.ENCRYPTION_KEY
);
```

#### ุงูุชุดููุฑ ุฃุซูุงุก ุงูููู
```nginx
# ุฅุนุฏุงุฏุงุช SSL/TLS ูู Nginx
server {
    listen 443 ssl http2;
    
    # ุดูุงุฏุงุช SSL
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    # ุฅุนุฏุงุฏุงุช ุงูุชุดููุฑ ุงููููุฉ
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=63072000" always;
    
    # ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
}
```

### ุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุชุดููุฑ MongoDB
```javascript
// ุฅุนุฏุงุฏุงุช ุชุดููุฑ MongoDB
const mongoOptions = {
  ssl: true,
  sslValidate: true,
  sslCA: fs.readFileSync('/path/to/ca.pem'),
  authSource: 'admin',
  authMechanism: 'SCRAM-SHA-256'
};

// ุงุชุตุงู ุขูู
mongoose.connect(process.env.MONGODB_URI, mongoOptions);
```

#### ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงููุดูุฑุฉ
```bash
#!/bin/bash
# ุณูุฑูุจุช ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุดูุฑ

BACKUP_DIR="/secure/backups"
DATE=$(date +%Y%m%d_%H%M%S)
ENCRYPTION_KEY="/secure/keys/backup.key"

# ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
mongodump --host localhost --port 27017 --db hospital_erp --out /tmp/backup_$DATE

# ุชุดููุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
tar -czf - /tmp/backup_$DATE | openssl enc -aes-256-cbc -salt -k $(cat $ENCRYPTION_KEY) > $BACKUP_DIR/backup_$DATE.tar.gz.enc

# ุญุฐู ุงููุณุฎุฉ ุบูุฑ ุงููุดูุฑุฉ
rm -rf /tmp/backup_$DATE

echo "ุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุดูุฑุฉ: backup_$DATE.tar.gz.enc"
```

### ุฅุฎูุงุก ุงููููุฉ (Data Anonymization)

```javascript
// ุฅุฎูุงุก ูููุฉ ุงูุจูุงูุงุช ููุฃุจุญุงุซ
const anonymizePatientData = (patient) => {
  return {
    id: hashId(patient.id),
    age: calculateAgeGroup(patient.dateOfBirth),
    gender: patient.gender,
    diagnosis: patient.diagnosis,
    treatment: patient.treatment,
    // ุฅุฒุงูุฉ ุงููุนุฑูุงุช ุงูุดุฎุตูุฉ
    // name, nationalId, phone, email ูุญุฐููุฉ
  };
};

const hashId = (id) => {
  return crypto.createHash('sha256')
    .update(id + process.env.ANONYMIZATION_SALT)
    .digest('hex')
    .substring(0, 16);
};
```

## ุงููุตุงุฏูุฉ ูุงูุชูููุถ

### ุงููุตุงุฏูุฉ ูุชุนุฏุฏุฉ ุงูุนูุงูู (MFA)

#### ุชุทุจูู MFA
```javascript
const speakeasy = require('speakeasy');
const QRCode = require('qrcode');

// ุฅูุดุงุก ุณุฑ TOTP ูููุณุชุฎุฏู
const generateMFASecret = async (userId) => {
  const secret = speakeasy.generateSecret({
    name: `Hospital ERP (${userId})`,
    issuer: 'Hospital Management System'
  });
  
  // ุญูุธ ุงูุณุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุดูุฑ)
  await User.findByIdAndUpdate(userId, {
    mfaSecret: encrypt(secret.base32),
    mfaEnabled: false // ุณูุชู ุชูุนููู ุจุนุฏ ุงูุชุญูู
  });
  
  // ุฅูุดุงุก QR Code
  const qrCodeUrl = await QRCode.toDataURL(secret.otpauth_url);
  
  return {
    secret: secret.base32,
    qrCode: qrCodeUrl
  };
};

// ุงูุชุญูู ูู ุฑูุฒ MFA
const verifyMFA = (token, secret) => {
  return speakeasy.totp.verify({
    secret: secret,
    encoding: 'base32',
    token: token,
    window: 2 // ุงูุณูุงุญ ุจู ยฑ2 ูุชุฑุงุช ุฒูููุฉ
  });
};
```

#### ุชุณุฌูู ุงูุฏุฎูู ูุน MFA
```javascript
app.post('/api/auth/login', async (req, res) => {
  const { email, password, mfaToken } = req.body;
  
  try {
    // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
    const user = await User.findOne({ email });
    if (!user || !await bcrypt.compare(password, user.password)) {
      return res.status(401).json({ error: 'ุจูุงูุงุช ุฏุฎูู ุบูุฑ ุตุญูุญุฉ' });
    }
    
    // ุงูุชุญูู ูู MFA ุฅุฐุง ูุงู ููุนู
    if (user.mfaEnabled) {
      if (!mfaToken) {
        return res.status(200).json({ 
          requiresMFA: true,
          message: 'ูุฑุฌู ุฅุฏุฎุงู ุฑูุฒ ุงูุชุญูู' 
        });
      }
      
      const secret = decrypt(user.mfaSecret);
      if (!verifyMFA(mfaToken, secret)) {
        return res.status(401).json({ error: 'ุฑูุฒ ุงูุชุญูู ุบูุฑ ุตุญูุญ' });
      }
    }
    
    // ุฅูุดุงุก JWT
    const token = jwt.sign(
      { userId: user._id, role: user.role },
      process.env.JWT_SECRET,
      { expiresIn: '8h' }
    );
    
    // ุชุณุฌูู ุชุณุฌูู ุงูุฏุฎูู
    await logSecurityEvent({
      type: 'LOGIN_SUCCESS',
      userId: user._id,
      ipAddress: req.ip,
      userAgent: req.get('User-Agent')
    });
    
    res.json({ token, user: sanitizeUser(user) });
    
  } catch (error) {
    await logSecurityEvent({
      type: 'LOGIN_ERROR',
      email,
      error: error.message,
      ipAddress: req.ip
    });
    
    res.status(500).json({ error: 'ุฎุทุฃ ูู ุงูุฎุงุฏู' });
  }
});
```

### ุงูุชุญูู ูู ุงููุตูู ุงููุงุฆู ุนูู ุงูุฃุฏูุงุฑ (RBAC)

#### ุชุนุฑูู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
```javascript
const roles = {
  admin: {
    permissions: ['*'] // ุฌููุน ุงูุตูุงุญูุงุช
  },
  doctor: {
    permissions: [
      'patients:read',
      'patients:write',
      'medical_records:read',
      'medical_records:write',
      'prescriptions:write',
      'appointments:read',
      'appointments:write'
    ]
  },
  nurse: {
    permissions: [
      'patients:read',
      'patients:update_vitals',
      'medical_records:read',
      'appointments:read',
      'medications:administer'
    ]
  },
  pharmacist: {
    permissions: [
      'prescriptions:read',
      'prescriptions:dispense',
      'inventory:read',
      'inventory:update'
    ]
  }
};

// middleware ููุชุญูู ูู ุงูุตูุงุญูุงุช
const checkPermission = (requiredPermission) => {
  return (req, res, next) => {
    const userRole = req.user.role;
    const userPermissions = roles[userRole]?.permissions || [];
    
    // ุงูุชุญูู ูู ุงูุตูุงุญูุฉ ุงูุดุงููุฉ
    if (userPermissions.includes('*')) {
      return next();
    }
    
    // ุงูุชุญูู ูู ุงูุตูุงุญูุฉ ุงููุญุฏุฏุฉ
    if (userPermissions.includes(requiredPermission)) {
      return next();
    }
    
    // ุชุณุฌูู ูุญุงููุฉ ุงููุตูู ุบูุฑ ุงููุตุฑุญ
    logSecurityEvent({
      type: 'UNAUTHORIZED_ACCESS_ATTEMPT',
      userId: req.user.id,
      requiredPermission,
      userRole,
      endpoint: req.path,
      ipAddress: req.ip
    });
    
    res.status(403).json({ error: 'ุบูุฑ ูุตุฑุญ ูู ุจูุฐุง ุงูุฅุฌุฑุงุก' });
  };
};
```

#### ุงูุชุญูู ูู ุงููุตูู ููุจูุงูุงุช
```javascript
// ุงูุชุญูู ูู ูุตูู ุงูุฃุทุจุงุก ูุจูุงูุงุช ุงููุฑุถู
const canAccessPatient = async (doctorId, patientId) => {
  // ุงูุชุญูู ูู ูุฌูุฏ ุนูุงูุฉ ุทุจูุจ-ูุฑูุถ ูุดุทุฉ
  const relationship = await DoctorPatientRelationship.findOne({
    doctorId,
    patientId,
    status: 'active'
  });
  
  if (relationship) return true;
  
  // ุงูุชุญูู ูู ูุฌูุฏ ููุนุฏ ูุฌุฏูู
  const appointment = await Appointment.findOne({
    doctorId,
    patientId,
    date: { $gte: new Date() },
    status: { $in: ['scheduled', 'in_progress'] }
  });
  
  return !!appointment;
};

// middleware ููุชุญูู ูู ุงููุตูู ูููุฑูุถ
const checkPatientAccess = async (req, res, next) => {
  const { patientId } = req.params;
  const { userId, role } = req.user;
  
  // ุงููุฏูุฑูู ูุฏููู ูุตูู ูุงูู
  if (role === 'admin') return next();
  
  // ุงูุฃุทุจุงุก ูุญุชุงุฌูู ุนูุงูุฉ ูุน ุงููุฑูุถ
  if (role === 'doctor') {
    const hasAccess = await canAccessPatient(userId, patientId);
    if (!hasAccess) {
      return res.status(403).json({ 
        error: 'ุบูุฑ ูุตุฑุญ ูู ุจุงููุตูู ูุจูุงูุงุช ูุฐุง ุงููุฑูุถ' 
      });
    }
  }
  
  next();
};
```

## ุฃูุงู ุงูุดุจูุฉ

### ุฌุฏุงุฑ ุงูุญูุงูุฉ (Firewall)

#### ุฅุนุฏุงุฏุงุช UFW
```bash
# ุงูุณูุงุญ ุจุงูุฎุฏูุงุช ุงูุฃุณุงุณูุฉ ููุท
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH (ูุน ุชูููุฏ IP ุฅุฐุง ุฃููู)
sudo ufw allow from 192.168.1.0/24 to any port 22

# HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# ููุงุนุฏ ุงูุจูุงูุงุช (ูุญูู ููุท)
sudo ufw deny 27017  # MongoDB
sudo ufw deny 6379   # Redis

# ุชูุนูู ุงูุฌุฏุงุฑ
sudo ufw enable
```

#### ุฅุนุฏุงุฏุงุช iptables ุงููุชูุฏูุฉ
```bash
#!/bin/bash
# ุณูุฑูุจุช ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงููุชูุฏู

# ูุณุญ ุงูููุงุนุฏ ุงูุญุงููุฉ
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X

# ุงูุณูุงุณุฉ ุงูุงูุชุฑุงุถูุฉ
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# ุงูุณูุงุญ ุจุงูุงุชุตุงูุงุช ุงููุญููุฉ
iptables -A INPUT -i lo -j ACCEPT

# ุงูุณูุงุญ ุจุงูุงุชุตุงูุงุช ุงููุคุณุณุฉ
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# ุญูุงูุฉ ูู DDoS
iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT

# ููุน port scanning
iptables -A INPUT -m conntrack --ctstate NEW -m recent --set
iptables -A INPUT -m conntrack --ctstate NEW -m recent --update --seconds 60 --hitcount 10 -j DROP
```

### ุดุจูุฉ VPN

#### ุฅุนุฏุงุฏ OpenVPN ูููุตูู ุงูุขูู
```bash
# ุชุซุจูุช OpenVPN
sudo apt install openvpn easy-rsa -y

# ุฅุนุฏุงุฏ CA
make-cadir ~/openvpn-ca
cd ~/openvpn-ca
source vars
./clean-all
./build-ca

# ุฅูุดุงุก ุดูุงุฏุฉ ุงูุฎุงุฏู
./build-key-server server

# ุฅูุดุงุก ููุงุชูุญ ุงูุนููุงุก
./build-key client1
./build-key client2
```

### ูุฑุงูุจุฉ ุงูุดุจูุฉ

#### ุงุณุชุฎุฏุงู Fail2Ban
```ini
# /etc/fail2ban/jail.local
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log

[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log

[hospital-erp-auth]
enabled = true
filter = hospital-erp-auth
logpath = /var/log/hospital-erp/security.log
maxretry = 5
```

## ุฃูุงู ุงูุชุทุจูู

### ุญูุงูุฉ ูู ุงูุซุบุฑุงุช ุงูุดุงุฆุนุฉ

#### ุญูุงูุฉ ูู SQL Injection
```javascript
// ุงุณุชุฎุฏุงู Mongoose ูุน ุงูุชุญูู ูู ุงููุฏุฎูุงุช
const mongoose = require('mongoose');

// ุชุนุฑูู Schema ูุน ุงูุชุญูู
const patientSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
    trim: true,
    maxlength: 100,
    validate: {
      validator: (v) => /^[a-zA-Zุฃ-ู\s]+$/.test(v),
      message: 'ุงูุงุณู ูุฌุจ ุฃู ูุญุชูู ุนูู ุฃุญุฑู ููุท'
    }
  },
  nationalId: {
    type: String,
    required: true,
    unique: true,
    validate: {
      validator: (v) => /^\d{10}$/.test(v),
      message: 'ุฑูู ุงููููุฉ ูุฌุจ ุฃู ูููู 10 ุฃุฑูุงู'
    }
  }
});

// ุงุณุชุฎุฏุงู parameterized queries
const findPatientByNationalId = async (nationalId) => {
  // ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎู
  if (!/^\d{10}$/.test(nationalId)) {
    throw new Error('ุฑูู ูููุฉ ุบูุฑ ุตุญูุญ');
  }
  
  return await Patient.findOne({ nationalId });
};
```

#### ุญูุงูุฉ ูู XSS
```javascript
const helmet = require('helmet');
const xss = require('xss');

// ุงุณุชุฎุฏุงู Helmet ููุญูุงูุฉ
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      scriptSrc: ["'self'"],
      imgSrc: ["'self'", "data:", "https:"],
      connectSrc: ["'self'"],
      fontSrc: ["'self'"],
      objectSrc: ["'none'"],
      mediaSrc: ["'self'"],
      frameSrc: ["'none'"]
    }
  }
}));

// ุชูุธูู ุงููุฏุฎูุงุช
const sanitizeInput = (input) => {
  if (typeof input === 'string') {
    return xss(input, {
      whiteList: {}, // ูุง ุชูุฌุฏ ุนูุงูุงุช HTML ูุณููุญุฉ
      stripIgnoreTag: true,
      stripIgnoreTagBody: ['script']
    });
  }
  return input;
};

// middleware ูุชูุธูู ุฌููุน ุงููุฏุฎูุงุช
app.use((req, res, next) => {
  if (req.body) {
    req.body = sanitizeObject(req.body);
  }
  if (req.query) {
    req.query = sanitizeObject(req.query);
  }
  next();
});
```

#### ุญูุงูุฉ ูู CSRF
```javascript
const csrf = require('csurf');

// ุฅุนุฏุงุฏ CSRF protection
const csrfProtection = csrf({
  cookie: {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'strict'
  }
});

// ุชุทุจูู ุงูุญูุงูุฉ ุนูู ุงูุทุฑู ุงููููุฉ
app.use('/api/patients', csrfProtection);
app.use('/api/medical-records', csrfProtection);
app.use('/api/prescriptions', csrfProtection);

// ุฅุฑุณุงู CSRF token ููุนููู
app.get('/api/csrf-token', csrfProtection, (req, res) => {
  res.json({ csrfToken: req.csrfToken() });
});
```

### ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช

```javascript
const Joi = require('joi');

// ุชุนุฑูู schemas ููุชุญูู
const patientSchema = Joi.object({
  name: Joi.string().min(2).max(100).pattern(/^[a-zA-Zุฃ-ู\s]+$/).required(),
  dateOfBirth: Joi.date().max('now').required(),
  gender: Joi.string().valid('male', 'female').required(),
  nationalId: Joi.string().pattern(/^\d{10}$/).required(),
  phone: Joi.string().pattern(/^\+966[0-9]{9}$/).required(),
  email: Joi.string().email().optional(),
  address: Joi.object({
    street: Joi.string().max(200).required(),
    city: Joi.string().max(50).required(),
    zipCode: Joi.string().pattern(/^\d{5}$/).required()
  }).required()
});

// middleware ููุชุญูู
const validatePatient = (req, res, next) => {
  const { error, value } = patientSchema.validate(req.body);
  
  if (error) {
    return res.status(400).json({
      error: 'ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ',
      details: error.details.map(detail => ({
        field: detail.path.join('.'),
        message: detail.message
      }))
    });
  }
  
  req.body = value;
  next();
};
```

## ูุฑุงูุจุฉ ุงูุฃูุงู

### ุชุณุฌูู ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ

```javascript
const winston = require('winston');

// ุฅุนุฏุงุฏ logger ููุฃูุงู
const securityLogger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ 
      filename: '/var/log/hospital-erp/security.log',
      maxsize: 10485760, // 10MB
      maxFiles: 10
    }),
    new winston.transports.Console()
  ]
});

// ุชุณุฌูู ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ
const logSecurityEvent = async (event) => {
  const securityEvent = {
    timestamp: new Date().toISOString(),
    type: event.type,
    severity: getSeverity(event.type),
    userId: event.userId,
    ipAddress: event.ipAddress,
    userAgent: event.userAgent,
    details: event.details,
    sessionId: event.sessionId
  };
  
  securityLogger.info(securityEvent);
  
  // ุฅุฑุณุงู ุชูุจูู ููุฃุญุฏุงุซ ุงูุญุฑุฌุฉ
  if (securityEvent.severity === 'critical') {
    await sendSecurityAlert(securityEvent);
  }
};

// ุชุญุฏูุฏ ูุณุชูู ุงูุฎุทูุฑุฉ
const getSeverity = (eventType) => {
  const severityMap = {
    'LOGIN_SUCCESS': 'info',
    'LOGIN_FAILURE': 'warning',
    'MULTIPLE_LOGIN_FAILURES': 'high',
    'UNAUTHORIZED_ACCESS': 'high',
    'DATA_BREACH_ATTEMPT': 'critical',
    'PRIVILEGE_ESCALATION': 'critical',
    'SUSPICIOUS_ACTIVITY': 'high'
  };
  
  return severityMap[eventType] || 'medium';
};
```

### ูุฑุงูุจุฉ ุงูุฃูุดุทุฉ ุงููุดุจููุฉ

```javascript
// ูุดู ูุญุงููุงุช ุงูุฏุฎูู ุงููุชุนุฏุฏุฉ
const detectBruteForce = async (email, ipAddress) => {
  const key = `login_attempts:${email}:${ipAddress}`;
  const attempts = await redis.incr(key);
  
  if (attempts === 1) {
    await redis.expire(key, 900); // 15 ุฏูููุฉ
  }
  
  if (attempts >= 5) {
    await logSecurityEvent({
      type: 'MULTIPLE_LOGIN_FAILURES',
      email,
      ipAddress,
      attempts
    });
    
    // ุญุธุฑ IP ูุคูุชุงู
    await redis.setex(`blocked_ip:${ipAddress}`, 3600, 'true');
    
    return true; // ูุญุธูุฑ
  }
  
  return false;
};

// ูุดู ุงูุฃูุดุทุฉ ุบูุฑ ุงูุนุงุฏูุฉ
const detectAnomalousActivity = async (userId, activity) => {
  const userProfile = await getUserActivityProfile(userId);
  
  // ูุญุต ุงูููุช ุบูุฑ ุงูุนุงุฏู
  const currentHour = new Date().getHours();
  if (currentHour < 6 || currentHour > 22) {
    if (!userProfile.nightShiftWorker) {
      await logSecurityEvent({
        type: 'UNUSUAL_TIME_ACCESS',
        userId,
        time: currentHour,
        activity
      });
    }
  }
  
  // ูุญุต ุงููููุน ุบูุฑ ุงูุนุงุฏู
  const userLocation = await getUserLocation(userId);
  const currentLocation = await getLocationFromIP(activity.ipAddress);
  
  if (calculateDistance(userLocation, currentLocation) > 100) {
    await logSecurityEvent({
      type: 'UNUSUAL_LOCATION_ACCESS',
      userId,
      expectedLocation: userLocation,
      actualLocation: currentLocation,
      activity
    });
  }
};
```

### ุชูุจููุงุช ุงูุฃูุงู ูู ุงูููุช ุงููุนูู

```javascript
// ุฅุฑุณุงู ุชูุจููุงุช ุงูุฃูุงู
const sendSecurityAlert = async (event) => {
  const alert = {
    id: generateAlertId(),
    timestamp: event.timestamp,
    type: event.type,
    severity: event.severity,
    description: getEventDescription(event),
    affectedUser: event.userId,
    sourceIP: event.ipAddress,
    recommendedActions: getRecommendedActions(event.type)
  };
  
  // ุฅุฑุณุงู ูููุฑูู ุงูุฃููู
  await notifySecurityTeam(alert);
  
  // ุฅุฑุณุงู ุนุจุฑ WebSocket ูููุฏูุฑูู ุงููุชุตููู
  io.to('security_admins').emit('security_alert', alert);
  
  // ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  await SecurityAlert.create(alert);
};

// ุงูุฅุฌุฑุงุกุงุช ุงูููุตู ุจูุง
const getRecommendedActions = (eventType) => {
  const actions = {
    'MULTIPLE_LOGIN_FAILURES': [
      'ุญุธุฑ ุนููุงู IP ูุคูุชุงู',
      'ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู',
      'ุชูุนูู ุงููุตุงุฏูุฉ ูุชุนุฏุฏุฉ ุงูุนูุงูู'
    ],
    'UNAUTHORIZED_ACCESS': [
      'ูุฑุงุฌุนุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏู',
      'ุชุณุฌูู ุฎุฑูุฌ ุฌููุน ุฌูุณุงุช ุงููุณุชุฎุฏู',
      'ุชุญููู ุฃููู ููุฑู'
    ],
    'DATA_BREACH_ATTEMPT': [
      'ุนุฒู ุงููุธุงู ุงููุชุฃุซุฑ',
      'ุฅุดุนุงุฑ ุฅุฏุงุฑุฉ ุงููุณุชุดูู',
      'ุชูุนูู ุฎุทุฉ ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ'
    ]
  };
  
  return actions[eventType] || ['ูุฑุงุฌุนุฉ ูุฏููุฉ ูุทููุจุฉ'];
};
```

## ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูุงูุงุณุชุนุงุฏุฉ

### ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

#### ูุงุนุฏุฉ 3-2-1
- **3** ูุณุฎ ูู ุงูุจูุงูุงุช ุงููููุฉ
- **2** ูุณุงุฆุท ุชุฎุฒูู ูุฎุชููุฉ
- **1** ูุณุฎุฉ ุฎุงุฑุฌ ุงููููุน

#### ุฌุฏููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
```bash
# /etc/crontab
# ูุณุฎ ุงุญุชูุงุทูุฉ ููููุฉ ููุจูุงูุงุช ุงูุญุฑุฌุฉ
0 2 * * * root /usr/local/bin/backup-critical-data.sh

# ูุณุฎ ุงุญุชูุงุทูุฉ ุฃุณุจูุนูุฉ ูุงููุฉ
0 1 * * 0 root /usr/local/bin/backup-full-system.sh

# ูุณุฎ ุงุญุชูุงุทูุฉ ุดูุฑูุฉ ููุฃุฑุดูู
0 0 1 * * root /usr/local/bin/backup-archive.sh
```

#### ุณูุฑูุจุช ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุชูุฏู
```bash
#!/bin/bash
# backup-critical-data.sh

set -e

# ุงููุชุบูุฑุงุช
BACKUP_DIR="/secure/backups"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30
ENCRYPTION_KEY="/secure/keys/backup.key"
LOG_FILE="/var/log/backup.log"

# ุฏุงูุฉ ุงูุชุณุฌูู
log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

# ุฏุงูุฉ ุงูุชุดููุฑ
encrypt_backup() {
    local source=$1
    local destination=$2
    
    tar -czf - "$source" | openssl enc -aes-256-cbc -salt -k $(cat $ENCRYPTION_KEY) > "$destination"
}

# ุฏุงูุฉ ุงูุชุญูู ูู ุงูุชูุงูู
verify_backup() {
    local backup_file=$1
    
    # ุญุณุงุจ checksum
    sha256sum "$backup_file" > "${backup_file}.sha256"
    
    # ุงูุชุญูู ูู ุฅููุงููุฉ ูู ุงูุชุดููุฑ
    openssl enc -aes-256-cbc -d -k $(cat $ENCRYPTION_KEY) -in "$backup_file" | tar -tzf - > /dev/null
    
    if [ $? -eq 0 ]; then
        log "ุชู ุงูุชุญูู ูู ุณูุงูุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: $backup_file"
        return 0
    else
        log "ุฎุทุฃ ูู ุงูุชุญูู ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: $backup_file"
        return 1
    fi
}

# ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฑุฆูุณู
main() {
    log "ุจุฏุก ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููููู"
    
    # ุฅูุดุงุก ูุฌูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
    mkdir -p "$BACKUP_DIR/daily"
    
    # ูุณุฎ ุงุญุชูุงุทู ููุงุนุฏุฉ ุงูุจูุงูุงุช
    log "ูุณุฎ ุงุญุชูุงุทู ููุงุนุฏุฉ ุงูุจูุงูุงุช"
    mongodump --host localhost --port 27017 --db hospital_erp --out "/tmp/db_backup_$DATE"
    encrypt_backup "/tmp/db_backup_$DATE" "$BACKUP_DIR/daily/db_backup_$DATE.tar.gz.enc"
    verify_backup "$BACKUP_DIR/daily/db_backup_$DATE.tar.gz.enc"
    rm -rf "/tmp/db_backup_$DATE"
    
    # ูุณุฎ ุงุญุชูุงุทู ูููููุงุช ุงููุฑููุนุฉ
    log "ูุณุฎ ุงุญุชูุงุทู ูููููุงุช"
    encrypt_backup "/var/hospital-erp/uploads" "$BACKUP_DIR/daily/files_backup_$DATE.tar.gz.enc"
    verify_backup "$BACKUP_DIR/daily/files_backup_$DATE.tar.gz.enc"
    
    # ูุณุฎ ุงุญุชูุงุทู ููุฅุนุฏุงุฏุงุช
    log "ูุณุฎ ุงุญุชูุงุทู ููุฅุนุฏุงุฏุงุช"
    encrypt_backup "/etc/hospital-erp" "$BACKUP_DIR/daily/config_backup_$DATE.tar.gz.enc"
    verify_backup "$BACKUP_DIR/daily/config_backup_$DATE.tar.gz.enc"
    
    # ุญุฐู ุงููุณุฎ ุงููุฏููุฉ
    log "ุญุฐู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงููุฏููุฉ"
    find "$BACKUP_DIR/daily" -name "*.tar.gz.enc" -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_DIR/daily" -name "*.sha256" -mtime +$RETENTION_DAYS -delete
    
    # ุฑูุน ููุชุฎุฒูู ุงูุณุญุงุจู (ุงุฎุชูุงุฑู)
    if [ -n "$CLOUD_BACKUP_ENABLED" ]; then
        log "ุฑูุน ููุชุฎุฒูู ุงูุณุญุงุจู"
        aws s3 sync "$BACKUP_DIR/daily" s3://hospital-erp-backups/daily/ --delete
    fi
    
    log "ุงูุชูุงุก ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููููู"
}

# ุชูููุฐ ุงูุณูุฑูุจุช
main
```

### ุฎุทุฉ ุงูุงุณุชุนุงุฏุฉ ูู ุงูููุงุฑุซ

#### ุฅุฌุฑุงุกุงุช ุงูุงุณุชุนุงุฏุฉ ุงูุณุฑูุนุฉ
```bash
#!/bin/bash
# disaster-recovery.sh

# ูุชุบูุฑุงุช ุงูุงุณุชุนุงุฏุฉ
BACKUP_DIR="/secure/backups"
RECOVERY_DIR="/tmp/recovery"
ENCRYPTION_KEY="/secure/keys/backup.key"

# ุฏุงูุฉ ุงูุงุณุชุนุงุฏุฉ
restore_from_backup() {
    local backup_file=$1
    local restore_path=$2
    
    echo "ุงุณุชุนุงุฏุฉ ูู: $backup_file"
    echo "ุฅูู: $restore_path"
    
    # ูู ุงูุชุดููุฑ ูุงูุงุณุชุฎุฑุงุฌ
    openssl enc -aes-256-cbc -d -k $(cat $ENCRYPTION_KEY) -in "$backup_file" | tar -xzf - -C "$restore_path"
    
    if [ $? -eq 0 ]; then
        echo "ุชูุช ุงูุงุณุชุนุงุฏุฉ ุจูุฌุงุญ"
        return 0
    else
        echo "ูุดู ูู ุงูุงุณุชุนุงุฏุฉ"
        return 1
    fi
}

# ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
restore_database() {
    local backup_date=$1
    
    echo "ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุชุงุฑูุฎ: $backup_date"
    
    # ุฅููุงู ุงูุฎุฏูุฉ
    systemctl stop hospital-erp
    
    # ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    restore_from_backup "$BACKUP_DIR/daily/db_backup_$backup_date.tar.gz.enc" "$RECOVERY_DIR"
    
    # ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
    mongorestore --host localhost --port 27017 --db hospital_erp --drop "$RECOVERY_DIR/db_backup_$backup_date/hospital_erp"
    
    # ุชุดุบูู ุงูุฎุฏูุฉ
    systemctl start hospital-erp
    
    echo "ุชูุช ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช"
}

# ุงุณุชุนุงุฏุฉ ูุงููุฉ ูููุธุงู
full_system_restore() {
    local backup_date=$1
    
    echo "ุจุฏุก ุงูุงุณุชุนุงุฏุฉ ุงููุงููุฉ ูููุธุงู"
    
    # ุฅููุงู ุฌููุน ุงูุฎุฏูุงุช
    systemctl stop hospital-erp nginx mongod redis
    
    # ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    restore_database $backup_date
    
    # ุงุณุชุนุงุฏุฉ ุงููููุงุช
    restore_from_backup "$BACKUP_DIR/daily/files_backup_$backup_date.tar.gz.enc" "/var/hospital-erp"
    
    # ุงุณุชุนุงุฏุฉ ุงูุฅุนุฏุงุฏุงุช
    restore_from_backup "$BACKUP_DIR/daily/config_backup_$backup_date.tar.gz.enc" "/etc"
    
    # ุชุดุบูู ุงูุฎุฏูุงุช
    systemctl start mongod redis nginx hospital-erp
    
    echo "ุชูุช ุงูุงุณุชุนุงุฏุฉ ุงููุงููุฉ ูููุธุงู"
}
```

## ุฅุฏุงุฑุฉ ุงูุญูุงุฏุซ ุงูุฃูููุฉ

### ุฎุทุฉ ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ

#### ูุฑุงุญู ุงูุงุณุชุฌุงุจุฉ
1. **ุงููุดู ูุงูุชุญููู**
2. **ุงูุงุญุชูุงุก ูุงููุถุงุก**
3. **ุงูุงุณุชุนุงุฏุฉ**
4. **ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ**

#### ุฅุฌุฑุงุกุงุช ุงูุทูุงุฑุฆ
```javascript
// ูุธุงู ุงูุงุณุชุฌุงุจุฉ ุงูุชููุงุฆูุฉ ููุญูุงุฏุซ
const incidentResponse = {
  // ูุดู ุงูุญุงุฏุซ
  detectIncident: async (event) => {
    const incident = {
      id: generateIncidentId(),
      type: classifyIncident(event),
      severity: assessSeverity(event),
      timestamp: new Date(),
      status: 'detected',
      events: [event]
    };
    
    await Incident.create(incident);
    await triggerResponse(incident);
    
    return incident;
  },
  
  // ุชุตููู ุงูุญุงุฏุซ
  classifyIncident: (event) => {
    const classifications = {
      'MULTIPLE_LOGIN_FAILURES': 'brute_force_attack',
      'UNAUTHORIZED_ACCESS': 'access_violation',
      'DATA_BREACH_ATTEMPT': 'data_breach',
      'MALWARE_DETECTED': 'malware_infection',
      'SYSTEM_COMPROMISE': 'system_breach'
    };
    
    return classifications[event.type] || 'unknown';
  },
  
  // ุชูููู ุงูุฎุทูุฑุฉ
  assessSeverity: (event) => {
    const severityMatrix = {
      'brute_force_attack': 'medium',
      'access_violation': 'high',
      'data_breach': 'critical',
      'malware_infection': 'high',
      'system_breach': 'critical'
    };
    
    return severityMatrix[event.type] || 'low';
  },
  
  // ุชูุนูู ุงูุงุณุชุฌุงุจุฉ
  triggerResponse: async (incident) => {
    // ุฅุดุนุงุฑ ููุฑู ูููุฑูู ุงูุฃููู
    await notifySecurityTeam(incident);
    
    // ุชูุนูู ุงูุฅุฌุฑุงุกุงุช ุงูุชููุงุฆูุฉ
    await executeAutomatedResponse(incident);
    
    // ุชุณุฌูู ุงูุญุงุฏุซ
    await logIncident(incident);
  }
};
```

#### ุงูุฅุฌุฑุงุกุงุช ุงูุชููุงุฆูุฉ
```javascript
const executeAutomatedResponse = async (incident) => {
  switch (incident.type) {
    case 'brute_force_attack':
      // ุญุธุฑ IP ุงูููุงุฌู
      await blockAttackerIP(incident.events[0].ipAddress);
      
      // ุชูุนูู MFA ูููุณุชุฎุฏู ุงููุณุชูุฏู
      await enforceUserMFA(incident.events[0].targetUser);
      break;
      
    case 'data_breach':
      // ุนุฒู ุงููุธุงู ุงููุชุฃุซุฑ
      await isolateAffectedSystem(incident.events[0].systemId);
      
      // ุชูุนูู ุชุดููุฑ ุฅุถุงูู
      await enableEmergencyEncryption();
      
      // ุฅุดุนุงุฑ ุงูุฅุฏุงุฑุฉ ุงูุนููุง
      await notifyExecutiveTeam(incident);
      break;
      
    case 'system_breach':
      // ุฅููุงู ุฌููุน ุงูุฌูุณุงุช ุงููุดุทุฉ
      await terminateAllSessions();
      
      // ุชูุนูู ูุถุน ุงูุทูุงุฑุฆ
      await enableEmergencyMode();
      
      // ุจุฏุก ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุทุงุฑุฆ
      await initiateEmergencyBackup();
      break;
  }
};
```

### ุงูุชุญููู ุงูุฑููู

#### ุฌูุน ุงูุฃุฏูุฉ
```javascript
const collectDigitalEvidence = async (incidentId) => {
  const evidence = {
    incidentId,
    collectionTime: new Date(),
    collector: 'automated_system',
    items: []
  };
  
  // ุฌูุน ุณุฌูุงุช ุงููุธุงู
  const systemLogs = await collectSystemLogs(incidentId);
  evidence.items.push({
    type: 'system_logs',
    data: systemLogs,
    hash: calculateHash(systemLogs)
  });
  
  // ุฌูุน ุณุฌูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const dbLogs = await collectDatabaseLogs(incidentId);
  evidence.items.push({
    type: 'database_logs',
    data: dbLogs,
    hash: calculateHash(dbLogs)
  });
  
  // ุฌูุน ุณุฌูุงุช ุงูุดุจูุฉ
  const networkLogs = await collectNetworkLogs(incidentId);
  evidence.items.push({
    type: 'network_logs',
    data: networkLogs,
    hash: calculateHash(networkLogs)
  });
  
  // ุญูุธ ุงูุฃุฏูุฉ ุจุดูู ุขูู
  await storeEvidence(evidence);
  
  return evidence;
};

// ุญูุธ ุงูุฃุฏูุฉ ูุน ุถูุงู ุงูุชูุงูู
const storeEvidence = async (evidence) => {
  // ุชุดููุฑ ุงูุฃุฏูุฉ
  const encryptedEvidence = encrypt(JSON.stringify(evidence));
  
  // ุญุณุงุจ ุงูุชูููุน ุงูุฑููู
  const signature = digitalSign(encryptedEvidence);
  
  // ุญูุธ ูู ูุฎุฒู ุขูู
  await EvidenceStore.create({
    incidentId: evidence.incidentId,
    data: encryptedEvidence,
    signature,
    timestamp: new Date(),
    chainOfCustody: [
      {
        handler: 'automated_system',
        action: 'collected',
        timestamp: new Date()
      }
    ]
  });
};
```

## ุงูุชุฏุฑูุจ ูุงูุชูุนูุฉ

### ุจุฑูุงูุฌ ุงูุชูุนูุฉ ุงูุฃูููุฉ

#### ููุถูุนุงุช ุงูุชุฏุฑูุจ
1. **ุฃุณุงุณูุงุช ุงูุฃูุงู ุงูุณูุจุฑุงูู**
2. **ุญูุงูุฉ ูููุงุช ุงููุฑูุฑ**
3. **ุงูุชุนุฑู ุนูู ุงูุชุตูุฏ ุงูุฅููุชุฑููู**
4. **ุฃูุงู ุงูุจูุงูุงุช ุงูุทุจูุฉ**
5. **ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ**

#### ุงุฎุชุจุงุฑุงุช ุงูุชุตูุฏ ุงููุญุงูุงุฉ
```javascript
// ูุธุงู ุงุฎุชุจุงุฑ ุงูุชุตูุฏ
const phishingSimulation = {
  // ุฅูุดุงุก ุญููุฉ ุงุฎุชุจุงุฑ
  createCampaign: async (targetUsers, template) => {
    const campaign = {
      id: generateCampaignId(),
      name: template.name,
      targetUsers,
      startDate: new Date(),
      status: 'active',
      results: []
    };
    
    // ุฅุฑุณุงู ุฑุณุงุฆู ุงุฎุชุจุงุฑ
    for (const user of targetUsers) {
      await sendPhishingTest(user, template, campaign.id);
    }
    
    return campaign;
  },
  
  // ุชุชุจุน ุงููุชุงุฆุฌ
  trackResult: async (campaignId, userId, action) => {
    const result = {
      campaignId,
      userId,
      action, // 'clicked', 'reported', 'ignored'
      timestamp: new Date()
    };
    
    await PhishingResult.create(result);
    
    // ุฅุฑุณุงู ุชุฏุฑูุจ ุฅุถุงูู ูููุณุชุฎุฏููู ุงูุฐูู ููุฑูุง
    if (action === 'clicked') {
      await scheduleSecurityTraining(userId);
    }
  },
  
  // ุชุญููู ุงููุชุงุฆุฌ
  analyzeResults: async (campaignId) => {
    const results = await PhishingResult.find({ campaignId });
    
    const analysis = {
      totalTargets: results.length,
      clickedCount: results.filter(r => r.action === 'clicked').length,
      reportedCount: results.filter(r => r.action === 'reported').length,
      ignoredCount: results.filter(r => r.action === 'ignored').length
    };
    
    analysis.clickRate = (analysis.clickedCount / analysis.totalTargets) * 100;
    analysis.reportRate = (analysis.reportedCount / analysis.totalTargets) * 100;
    
    return analysis;
  }
};
```

### ููุงููุณ ุงูุฃูุงู

#### ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ (KPIs)
```javascript
const securityMetrics = {
  // ูุนุฏู ุงูุญูุงุฏุซ ุงูุฃูููุฉ
  calculateIncidentRate: async (period) => {
    const incidents = await Incident.find({
      timestamp: { $gte: period.start, $lte: period.end }
    });
    
    return {
      total: incidents.length,
      critical: incidents.filter(i => i.severity === 'critical').length,
      high: incidents.filter(i => i.severity === 'high').length,
      medium: incidents.filter(i => i.severity === 'medium').length,
      low: incidents.filter(i => i.severity === 'low').length
    };
  },
  
  // ููุช ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ
  calculateResponseTime: async (period) => {
    const incidents = await Incident.find({
      timestamp: { $gte: period.start, $lte: period.end },
      status: 'resolved'
    });
    
    const responseTimes = incidents.map(incident => {
      const detectionTime = new Date(incident.timestamp);
      const responseTime = new Date(incident.responseTimestamp);
      return responseTime - detectionTime;
    });
    
    return {
      average: responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length,
      median: responseTimes.sort()[Math.floor(responseTimes.length / 2)],
      max: Math.max(...responseTimes),
      min: Math.min(...responseTimes)
    };
  },
  
  // ูุนุฏู ูุฌุงุญ ุงุฎุชุจุงุฑุงุช ุงูุชุตูุฏ
  calculatePhishingSuccessRate: async (period) => {
    const campaigns = await PhishingCampaign.find({
      startDate: { $gte: period.start, $lte: period.end }
    });
    
    let totalTargets = 0;
    let totalClicks = 0;
    let totalReports = 0;
    
    for (const campaign of campaigns) {
      const results = await PhishingResult.find({ campaignId: campaign.id });
      totalTargets += results.length;
      totalClicks += results.filter(r => r.action === 'clicked').length;
      totalReports += results.filter(r => r.action === 'reported').length;
    }
    
    return {
      clickRate: (totalClicks / totalTargets) * 100,
      reportRate: (totalReports / totalTargets) * 100,
      awarenessScore: ((totalReports - totalClicks) / totalTargets) * 100
    };
  }
};
```

---

**ูุฐุง ุงูุฏููู ูููุฑ ุฅุทุงุฑ ุนูู ุดุงูู ูุถูุงู ุฃูุงู ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุดููุงุช. ูุฌุจ ูุฑุงุฌุนุฉ ูุชุญุฏูุซ ูุฐู ุงูุฅุฌุฑุงุกุงุช ุจุงูุชุธุงู ููุชุฃูุฏ ูู ูุนุงููุชูุง ุถุฏ ุงูุชูุฏูุฏุงุช ุงููุชุทูุฑุฉ.**